###################################################
# Test the performance for InnoDB FTS Phrase Search
###################################################

--source include/big_test.inc
--source include/have_nodebug.inc
--source include/not_solaris.inc
--source include/not_asan.inc
--source include/not_valgrind.inc

CREATE TABLE `t` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `a` VARCHAR(90),
  `b` INT DEFAULT 1,
  PRIMARY KEY (`id`),
  FULLTEXT KEY (`a`)
) ENGINE=InnoDB;

DELIMITER |;

CREATE PROCEDURE expand_data(repeat_count INT)
BEGIN
    DECLARE i INT DEFAULT 0;

    WHILE i < repeat_count DO
        INSERT INTO t (a)
        SELECT a FROM t;
        SET i = i + 1;
    END WHILE;
END |

DELIMITER ;|

INSERT INTO t (a) VALUES
('amet consectetur adipiscing lorem ipsum'),
('amet consectetur adipiscing ipsum lorem'),
('amet consectetur lorem adipiscing ipsum'),
('amet consectetur lorem ipsum adipiscing'),
('amet consectetur ipsum adipiscing lorem'),
('amet consectetur ipsum lorem adipiscing'),
('amet adipiscing consectetur lorem ipsum'),
('amet adipiscing consectetur ipsum lorem'),
('amet adipiscing lorem consectetur ipsum'),
('amet adipiscing lorem ipsum consectetur'),
('amet adipiscing ipsum consectetur lorem'),
('amet adipiscing ipsum lorem consectetur'),
('amet lorem consectetur adipiscing ipsum'),
('amet lorem consectetur ipsum adipiscing'),
('amet lorem adipiscing consectetur ipsum'),
('amet lorem adipiscing ipsum consectetur'),
('amet lorem ipsum consectetur adipiscing'),
('amet lorem ipsum adipiscing consectetur'),
('amet ipsum consectetur adipiscing lorem'),
('amet ipsum consectetur lorem adipiscing'),
('amet ipsum adipiscing consectetur lorem'),
('amet ipsum adipiscing lorem consectetur'),
('amet ipsum lorem consectetur adipiscing'),
('amet ipsum lorem adipiscing consectetur'),
('consectetur amet adipiscing lorem ipsum'),
('consectetur amet adipiscing ipsum lorem'),
('consectetur amet lorem adipiscing ipsum'),
('consectetur amet lorem ipsum adipiscing'),
('consectetur amet ipsum adipiscing lorem'),
('consectetur amet ipsum lorem adipiscing'),
('consectetur adipiscing amet lorem ipsum'),
('consectetur adipiscing amet ipsum lorem'),
('consectetur adipiscing lorem amet ipsum'),
('consectetur adipiscing lorem ipsum amet'),
('consectetur adipiscing ipsum amet lorem'),
('consectetur adipiscing ipsum lorem amet'),
('consectetur lorem amet adipiscing ipsum'),
('consectetur lorem amet ipsum adipiscing'),
('consectetur lorem adipiscing amet ipsum'),
('consectetur lorem adipiscing ipsum amet'),
('consectetur lorem ipsum amet adipiscing'),
('consectetur lorem ipsum adipiscing amet'),
('consectetur ipsum amet adipiscing lorem'),
('consectetur ipsum amet lorem adipiscing'),
('consectetur ipsum adipiscing amet lorem'),
('consectetur ipsum adipiscing lorem amet'),
('consectetur ipsum lorem amet adipiscing'),
('consectetur ipsum lorem adipiscing amet'),
('adipiscing amet consectetur lorem ipsum'),
('adipiscing amet consectetur ipsum lorem'),
('adipiscing amet lorem consectetur ipsum'),
('adipiscing amet lorem ipsum consectetur'),
('adipiscing amet ipsum consectetur lorem'),
('adipiscing amet ipsum lorem consectetur'),
('adipiscing consectetur amet lorem ipsum'),
('adipiscing consectetur amet ipsum lorem'),
('adipiscing consectetur lorem amet ipsum'),
('adipiscing consectetur lorem ipsum amet'),
('adipiscing consectetur ipsum amet lorem'),
('adipiscing consectetur ipsum lorem amet'),
('adipiscing lorem amet consectetur ipsum'),
('adipiscing lorem amet ipsum consectetur'),
('adipiscing lorem consectetur amet ipsum'),
('adipiscing lorem consectetur ipsum amet'),
('adipiscing lorem ipsum amet consectetur'),
('adipiscing lorem ipsum consectetur amet'),
('adipiscing ipsum amet consectetur lorem'),
('adipiscing ipsum amet lorem consectetur'),
('adipiscing ipsum consectetur amet lorem'),
('adipiscing ipsum consectetur lorem amet'),
('adipiscing ipsum lorem amet consectetur'),
('adipiscing ipsum lorem consectetur amet'),
('lorem amet consectetur adipiscing ipsum'),
('lorem amet consectetur ipsum adipiscing'),
('lorem amet adipiscing consectetur ipsum'),
('lorem amet adipiscing ipsum consectetur'),
('lorem amet ipsum consectetur adipiscing'),
('lorem amet ipsum adipiscing consectetur'),
('lorem consectetur amet adipiscing ipsum'),
('lorem consectetur amet ipsum adipiscing'),
('lorem consectetur adipiscing amet ipsum'),
('lorem consectetur adipiscing ipsum amet'),
('lorem consectetur ipsum amet adipiscing'),
('lorem consectetur ipsum adipiscing amet'),
('lorem adipiscing amet consectetur ipsum'),
('lorem adipiscing amet ipsum consectetur'),
('lorem adipiscing consectetur amet ipsum'),
('lorem adipiscing consectetur ipsum amet'),
('lorem adipiscing ipsum amet consectetur'),
('lorem adipiscing ipsum consectetur amet'),
('lorem ipsum amet consectetur adipiscing'),
('lorem ipsum amet adipiscing consectetur'),
('lorem ipsum consectetur amet adipiscing'),
('lorem ipsum consectetur adipiscing amet'),
('lorem ipsum adipiscing amet consectetur'),
('lorem ipsum adipiscing consectetur amet'),
('ipsum amet consectetur adipiscing lorem'),
('ipsum amet consectetur lorem adipiscing'),
('ipsum amet adipiscing consectetur lorem'),
('ipsum amet adipiscing lorem consectetur'),
('ipsum amet lorem consectetur adipiscing'),
('ipsum amet lorem adipiscing consectetur'),
('ipsum consectetur amet adipiscing lorem'),
('ipsum consectetur amet lorem adipiscing'),
('ipsum consectetur adipiscing amet lorem'),
('ipsum consectetur adipiscing lorem amet'),
('ipsum consectetur lorem amet adipiscing'),
('ipsum consectetur lorem adipiscing amet'),
('ipsum adipiscing amet consectetur lorem'),
('ipsum adipiscing amet lorem consectetur'),
('ipsum adipiscing consectetur amet lorem'),
('ipsum adipiscing consectetur lorem amet'),
('ipsum adipiscing lorem amet consectetur'),
('ipsum adipiscing lorem consectetur amet'),
('ipsum lorem amet consectetur adipiscing'),
('ipsum lorem amet adipiscing consectetur'),
('ipsum lorem consectetur amet adipiscing'),
('ipsum lorem consectetur adipiscing amet'),
('ipsum lorem adipiscing amet consectetur'),
('ipsum lorem adipiscing consectetur amet');

INSERT INTO t (a) VALUES
('amet consectetur adipiscing lorem'),
('amet consectetur adipiscing ipsum'),
('amet consectetur lorem adipiscing'),
('amet consectetur lorem ipsum'),
('amet consectetur ipsum adipiscing'),
('amet consectetur ipsum lorem'),
('amet adipiscing consectetur lorem'),
('amet adipiscing consectetur ipsum'),
('amet adipiscing lorem consectetur'),
('amet adipiscing lorem ipsum'),
('amet adipiscing ipsum consectetur'),
('amet adipiscing ipsum lorem'),
('amet lorem consectetur adipiscing'),
('amet lorem consectetur ipsum'),
('amet lorem adipiscing consectetur'),
('amet lorem adipiscing ipsum'),
('amet lorem ipsum consectetur'),
('amet lorem ipsum adipiscing'),
('amet ipsum consectetur adipiscing'),
('amet ipsum consectetur lorem'),
('amet ipsum adipiscing consectetur'),
('amet ipsum adipiscing lorem'),
('amet ipsum lorem consectetur'),
('amet ipsum lorem adipiscing'),
('consectetur amet adipiscing lorem'),
('consectetur amet adipiscing ipsum'),
('consectetur amet lorem adipiscing'),
('consectetur amet lorem ipsum'),
('consectetur amet ipsum adipiscing'),
('consectetur amet ipsum lorem'),
('consectetur adipiscing amet lorem'),
('consectetur adipiscing amet ipsum'),
('consectetur adipiscing lorem amet'),
('consectetur adipiscing lorem ipsum'),
('consectetur adipiscing ipsum amet'),
('consectetur adipiscing ipsum lorem'),
('consectetur lorem amet adipiscing'),
('consectetur lorem amet ipsum'),
('consectetur lorem adipiscing amet'),
('consectetur lorem adipiscing ipsum'),
('consectetur lorem ipsum amet'),
('consectetur lorem ipsum adipiscing'),
('consectetur ipsum amet adipiscing'),
('consectetur ipsum amet lorem'),
('consectetur ipsum adipiscing amet'),
('consectetur ipsum adipiscing lorem'),
('consectetur ipsum lorem amet'),
('consectetur ipsum lorem adipiscing'),
('adipiscing amet consectetur lorem'),
('adipiscing amet consectetur ipsum'),
('adipiscing amet lorem consectetur'),
('adipiscing amet lorem ipsum'),
('adipiscing amet ipsum consectetur'),
('adipiscing amet ipsum lorem'),
('adipiscing consectetur amet lorem'),
('adipiscing consectetur amet ipsum'),
('adipiscing consectetur lorem amet'),
('adipiscing consectetur lorem ipsum'),
('adipiscing consectetur ipsum amet'),
('adipiscing consectetur ipsum lorem'),
('adipiscing lorem amet consectetur'),
('adipiscing lorem amet ipsum'),
('adipiscing lorem consectetur amet'),
('adipiscing lorem consectetur ipsum'),
('adipiscing lorem ipsum amet'),
('adipiscing lorem ipsum consectetur'),
('adipiscing ipsum amet consectetur'),
('adipiscing ipsum amet lorem'),
('adipiscing ipsum consectetur amet'),
('adipiscing ipsum consectetur lorem'),
('adipiscing ipsum lorem amet'),
('adipiscing ipsum lorem consectetur'),
('lorem amet consectetur adipiscing'),
('lorem amet consectetur ipsum'),
('lorem amet adipiscing consectetur'),
('lorem amet adipiscing ipsum'),
('lorem amet ipsum consectetur'),
('lorem amet ipsum adipiscing'),
('lorem consectetur amet adipiscing'),
('lorem consectetur amet ipsum'),
('lorem consectetur adipiscing amet'),
('lorem consectetur adipiscing ipsum'),
('lorem consectetur ipsum amet'),
('lorem consectetur ipsum adipiscing'),
('lorem adipiscing amet consectetur'),
('lorem adipiscing amet ipsum'),
('lorem adipiscing consectetur amet'),
('lorem adipiscing consectetur ipsum'),
('lorem adipiscing ipsum amet'),
('lorem adipiscing ipsum consectetur'),
('lorem ipsum amet consectetur'),
('lorem ipsum amet adipiscing'),
('lorem ipsum consectetur amet'),
('lorem ipsum consectetur adipiscing'),
('lorem ipsum adipiscing amet'),
('lorem ipsum adipiscing consectetur'),
('ipsum amet consectetur adipiscing'),
('ipsum amet consectetur lorem'),
('ipsum amet adipiscing consectetur'),
('ipsum amet adipiscing lorem'),
('ipsum amet lorem consectetur'),
('ipsum amet lorem adipiscing'),
('ipsum consectetur amet adipiscing'),
('ipsum consectetur amet lorem'),
('ipsum consectetur adipiscing amet'),
('ipsum consectetur adipiscing lorem'),
('ipsum consectetur lorem amet'),
('ipsum consectetur lorem adipiscing'),
('ipsum adipiscing amet consectetur'),
('ipsum adipiscing amet lorem'),
('ipsum adipiscing consectetur amet'),
('ipsum adipiscing consectetur lorem'),
('ipsum adipiscing lorem amet'),
('ipsum adipiscing lorem consectetur');

INSERT INTO t (a) VALUES
('amet consectetur adipiscing'),
('amet consectetur lorem'),
('amet consectetur ipsum'),
('amet adipiscing consectetur'),
('amet adipiscing lorem'),
('amet adipiscing ipsum'),
('amet lorem consectetur'),
('amet lorem adipiscing'),
('amet lorem ipsum'),
('amet ipsum consectetur'),
('amet ipsum adipiscing'),
('amet ipsum lorem'),
('consectetur amet adipiscing'),
('consectetur amet lorem'),
('consectetur amet ipsum'),
('consectetur adipiscing amet'),
('consectetur adipiscing lorem'),
('consectetur adipiscing ipsum'),
('consectetur lorem amet'),
('consectetur lorem adipiscing'),
('consectetur lorem ipsum'),
('consectetur ipsum amet'),
('consectetur ipsum adipiscing'),
('consectetur ipsum lorem'),
('adipiscing amet consectetur'),
('adipiscing amet lorem'),
('adipiscing amet ipsum'),
('adipiscing consectetur amet'),
('adipiscing consectetur lorem'),
('adipiscing consectetur ipsum'),
('adipiscing lorem amet'),
('adipiscing lorem consectetur'),
('adipiscing lorem ipsum'),
('adipiscing ipsum amet'),
('adipiscing ipsum consectetur'),
('adipiscing ipsum lorem'),
('lorem amet consectetur'),
('lorem amet adipiscing'),
('lorem amet ipsum'),
('lorem consectetur amet'),
('lorem consectetur adipiscing'),
('lorem consectetur ipsum'),
('lorem adipiscing amet'),
('lorem adipiscing consectetur'),
('lorem adipiscing ipsum'),
('lorem ipsum amet'),
('lorem ipsum consectetur'),
('lorem ipsum adipiscing'),
('ipsum amet consectetur'),
('ipsum amet adipiscing'),
('ipsum amet lorem'),
('ipsum consectetur amet'),
('ipsum consectetur adipiscing'),
('ipsum consectetur lorem'),
('ipsum adipiscing amet'),
('ipsum adipiscing consectetur'),
('ipsum adipiscing lorem'),
('ipsum lorem amet'),
('ipsum lorem consectetur'),
('ipsum lorem adipiscing');

INSERT INTO t (a) VALUES
('amet consectetur'),
('amet adipiscing'),
('amet lorem'),
('amet ipsum'),
('consectetur amet'),
('consectetur adipiscing'),
('consectetur lorem'),
('consectetur ipsum'),
('adipiscing amet'),
('adipiscing consectetur'),
('adipiscing lorem'),
('adipiscing ipsum'),
('lorem amet'),
('lorem consectetur'),
('lorem adipiscing'),
('lorem ipsum'),
('ipsum amet'),
('ipsum consectetur'),
('ipsum adipiscing'),
('ipsum lorem');

INSERT INTO t (a) VALUES
('amet'),
('consectetur'),
('adipiscing'),
('lorem'),
('ipsum');

CALL expand_data(11);

SELECT COUNT(*) FROM t;

SET SESSION max_execution_time=30000;

# Below SELECT statements should complete its execution within 30 seconds individually.
SELECT * FROM t WHERE MATCH(a) AGAINST (+'"amet consectetur"' IN BOOLEAN MODE) ORDER BY id LIMIT 1;
SELECT COUNT(*) FROM t WHERE MATCH(a) AGAINST (+'"amet consectetur"' IN BOOLEAN MODE);
SELECT * FROM t WHERE MATCH(a) AGAINST ('"amet consectetur"' IN NATURAL LANGUAGE MODE) ORDER BY id LIMIT 1;
SELECT COUNT(*) FROM t WHERE MATCH(a) AGAINST ('"amet consectetur"' IN NATURAL LANGUAGE MODE);

# Cleanup
DROP PROCEDURE expand_data;
DROP TABLE t;
