# åˆ›å»ºCDCä»»åŠ¡å®Œæ•´ä»£ç è°ƒç”¨æµç¨‹

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æ¢³ç†ä»ç”¨æˆ·è¯·æ±‚åˆ°MySQL binlogåŒæ­¥åˆ°Kafkaçš„å®Œæ•´ä»£ç è°ƒç”¨æµç¨‹ã€‚

---

## ğŸ¯ ä¸šåŠ¡åœºæ™¯

**ç›®æ ‡**: åˆ›å»ºä¸€ä¸ªCDCä»»åŠ¡ï¼Œå®æ—¶å°†MySQLæ•°æ®åº“çš„binlogå˜æ›´åŒæ­¥åˆ°Kafka

**æ¶‰åŠç»„ä»¶**:
- MySQLï¼ˆæ•°æ®æºï¼‰
- CDC Managerï¼ˆç®¡ç†å¹³å°ï¼‰
- Kubernetesï¼ˆè¿è¡Œç¯å¢ƒï¼‰
- CDC Workerï¼ˆå®é™…çš„binlogé‡‡é›†ç¨‹åºï¼‰
- Kafkaï¼ˆç›®æ ‡æ¶ˆæ¯é˜Ÿåˆ—ï¼‰

---

## ğŸ”„ å®Œæ•´è°ƒç”¨æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·å‘èµ·åˆ›å»ºCDCä»»åŠ¡è¯·æ±‚                        â”‚
â”‚              POST /api/tools/add_cdc_job                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Handlerå±‚: AddCDCJob()                                          â”‚
â”‚  æ–‡ä»¶: pkg/cdc/handler/tools_handler.go:182                      â”‚
â”‚                                                                   â”‚
â”‚  1. è§£æè¯·æ±‚å‚æ•°                                                  â”‚
â”‚     - MySQLé›†ç¾¤åç§°                                              â”‚
â”‚     - MySQLæ•°æ®åº“åˆ—è¡¨                                            â”‚
â”‚     - Kafkaé›†ç¾¤å’ŒTopic                                           â”‚
â”‚     - ç¯å¢ƒ/åŒºåŸŸ/å¯ç”¨åŒº                                            â”‚
â”‚                                                                   â”‚
â”‚  2. æ„é€  CDCJob å¯¹è±¡                                              â”‚
â”‚     job := db_model.CDCJob{                                      â”‚
â”‚         Env: "test/live",                                        â”‚
â”‚         JobName: "cluster-xxxx-uuid",                            â”‚
â”‚         ImageVersion: "v2.x.x",                                  â”‚
â”‚         Region: "sg/us",                                         â”‚
â”‚         Az: "sg10/us3",                                          â”‚
â”‚         CPU: 1000 (1æ ¸),                                         â”‚
â”‚         Memory: 2 (2GB),                                         â”‚
â”‚         JobStatus: CDCJobStatusStopped,                          â”‚
â”‚         RunSystem: "k8s",                                        â”‚
â”‚     }                                                            â”‚
â”‚                                                                   â”‚
â”‚  3. æ„é€  CDCJobDetail å¯¹è±¡ï¼ˆæ¯ä¸ªæ•°æ®åº“ä¸€æ¡ï¼‰                      â”‚
â”‚     for each database {                                          â”‚
â”‚         detail := db_model.CDCJobDetail{                         â”‚
â”‚             MysqlHost: "db-master-xxx",                          â”‚
â”‚             MysqlDatabase: "shopee_order_db",                    â”‚
â”‚             Topic: "cdc_topic_shopee_order",                     â”‚
â”‚             KafkaCluster: "kafka-cluster-sg",                    â”‚
â”‚             KafkaAddress: "kafka.sg.shopee.io:9092",             â”‚
â”‚         }                                                        â”‚
â”‚     }                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Serviceå±‚: BuildConfigForCDC()                                  â”‚
â”‚  æ–‡ä»¶: pkg/cdc/service/ticket_handler_service.go:716             â”‚
â”‚                                                                   â”‚
â”‚  æ„å»ºCDCä»»åŠ¡çš„JSONé…ç½®æ–‡ä»¶                                        â”‚
â”‚                                                                   â”‚
â”‚  config := CDCConfig{                                            â”‚
â”‚      Env: "live",                                                â”‚
â”‚      Name: job.JobName,                                          â”‚
â”‚      SourceInstance: "db-master-order-sg.shopee.io:6606",       â”‚
â”‚      SourceType: "mysql.no_schema",                              â”‚
â”‚      SourceUser: "rds_rep_gds",                                  â”‚
â”‚      SourcePassword: "****",                                     â”‚
â”‚      TargetType: "cdc",                                          â”‚
â”‚      SinkType: "cdc",                                            â”‚
â”‚                                                                   â”‚
â”‚      ExtraConfig: {                                              â”‚
â”‚          MetadataType: "mysql",  // æˆ– "http"                    â”‚
â”‚          MetadataAddr: "db-cdc-meta.shopee.io:6606",            â”‚
â”‚          MetadataNamespace: "shopee_cdc_meta_db",               â”‚
â”‚          MetadataUser: "cdc_meta",                               â”‚
â”‚          MetadataPasswd: "****",                                 â”‚
â”‚          Region: "sg",                                           â”‚
â”‚          Step: "db_stream_sync,",                                â”‚
â”‚      },                                                          â”‚
â”‚                                                                   â”‚
â”‚      CDCStreams: {                                               â”‚
â”‚          AllConfig: {                                            â”‚
â”‚              SendModel: "",                                      â”‚
â”‚              MergePurgeBinlog: false,                            â”‚
â”‚          },                                                      â”‚
â”‚          MQStreams: [                                            â”‚
â”‚              {                                                   â”‚
â”‚                  Type: "kafka",                                  â”‚
â”‚                  FilterRule: "^(shopee_order_db_00000000)\..*$",â”‚
â”‚                  Server: "kafka.sg.shopee.io:9092",             â”‚
â”‚                  Topic: "cdc_topic_shopee_order",                â”‚
â”‚                  User: "kafka-user",                             â”‚
â”‚                  Passwd: "****",                                 â”‚
â”‚                  PartitionKey: "db_name.table_name",             â”‚
â”‚                  ACKs: "WaitForAll",                             â”‚
â”‚                  FlushBatch: 50,                                 â”‚
â”‚                  MaxMessageBytes: 1048588,                       â”‚
â”‚              }                                                   â”‚
â”‚          ]                                                       â”‚
â”‚      }                                                           â”‚
â”‚  }                                                               â”‚
â”‚                                                                   â”‚
â”‚  job.CDCConfig = json.Marshal(config)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®åº“å±‚: ä¿å­˜åˆ°MySQL                                            â”‚
â”‚  æ–‡ä»¶: pkg/cdc/db/job_db.go                                      â”‚
â”‚                                                                   â”‚
â”‚  db.ExecInTx(                                                    â”‚
â”‚      // äº‹åŠ¡1: æ’å…¥ cdc_job è¡¨                                   â”‚
â”‚      func(tx *gorm.DB) error {                                   â”‚
â”‚          INSERT INTO cdc_job (                                   â”‚
â”‚              env, job_name, cdc_config,                          â”‚
â”‚              image_version, region, az,                          â”‚
â”‚              cpu, memory, business_level,                        â”‚
â”‚              job_status, run_system,                             â”‚
â”‚              create_time, update_time                            â”‚
â”‚          ) VALUES (...)                                          â”‚
â”‚      },                                                          â”‚
â”‚                                                                   â”‚
â”‚      // äº‹åŠ¡2: æ’å…¥ cdc_job_detail è¡¨ï¼ˆå¤šæ¡ï¼‰                    â”‚
â”‚      func(tx *gorm.DB) error {                                   â”‚
â”‚          for each detail {                                       â”‚
â”‚              INSERT INTO cdc_job_detail (                        â”‚
â”‚                  env, job_name,                                  â”‚
â”‚                  mysql_host, mysql_database,                     â”‚
â”‚                  topic, kafka_cluster, kafka_address,            â”‚
â”‚                  create_time, update_time                        â”‚
â”‚              ) VALUES (...)                                      â”‚
â”‚          }                                                       â”‚
â”‚      }                                                           â”‚
â”‚  )                                                               â”‚
â”‚                                                                   â”‚
â”‚  çŠ¶æ€: job_status = "stopped" (åˆå§‹çŠ¶æ€ï¼Œæœªå¯åŠ¨)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ âœ… CDCä»»åŠ¡åˆ›å»ºå®Œæˆï¼Œè¿”å›æˆåŠŸ
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ç”¨æˆ·å¯åŠ¨CDCä»»åŠ¡                                  â”‚
â”‚              POST /api/cdc/job/start                             â”‚
â”‚              Body: { "id": 12345 }                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Handlerå±‚: CDCJobStart()                                        â”‚
â”‚  æ–‡ä»¶: pkg/cdc/handler/job_handler.go:159                        â”‚
â”‚                                                                   â”‚
â”‚  1. è§£æè¯·æ±‚å‚æ•°ï¼ˆjobIDï¼‰                                         â”‚
â”‚  2. è·å–ç”¨æˆ·ä¿¡æ¯ï¼ˆuser emailï¼‰                                    â”‚
â”‚  3. è°ƒç”¨æœåŠ¡å±‚ StartCDCJob()                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Serviceå±‚: StartCDCJob()                                        â”‚
â”‚  æ–‡ä»¶: pkg/cdc/service/job_service.go:119                        â”‚
â”‚                                                                   â”‚
â”‚  1. ä»æ•°æ®åº“è·å–CDCä»»åŠ¡                                           â”‚
â”‚     job, err := db.GetCDCJob(id)                                 â”‚
â”‚                                                                   â”‚
â”‚  2. éªŒè¯ä»»åŠ¡çŠ¶æ€                                                  â”‚
â”‚     if job.JobStatus != CDCJobStatusStopped {                    â”‚
â”‚         return error("ä»»åŠ¡çŠ¶æ€ä¸æ˜¯stoppedï¼Œæ— æ³•å¯åŠ¨")            â”‚
â”‚     }                                                            â”‚
â”‚                                                                   â”‚
â”‚  3. è®°å½•æ“ä½œå†å²                                                  â”‚
â”‚     ohr := OperationHistoryRecord{                               â”‚
â”‚         Operator: user,                                          â”‚
â”‚         OperationType: CDCOperationStartJob,                     â”‚
â”‚         Reason: "Start CDC Job",                                 â”‚
â”‚     }                                                            â”‚
â”‚                                                                   â”‚
â”‚  4. åœ¨æ•°æ®åº“äº‹åŠ¡ä¸­æ‰§è¡Œï¼š                                          â”‚
â”‚     db.ExecInTx(                                                 â”‚
â”‚         // äº‹åŠ¡1: è¿è¡ŒCDCä»»åŠ¡                                    â”‚
â”‚         func(tx) { RunCDCJob(job) },                             â”‚
â”‚                                                                   â”‚
â”‚         // äº‹åŠ¡2: æ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸ºrunning                           â”‚
â”‚         func(tx) {                                               â”‚
â”‚             UPDATE cdc_job                                       â”‚
â”‚             SET job_status = 'running'                           â”‚
â”‚             WHERE id = ?                                         â”‚
â”‚         },                                                       â”‚
â”‚                                                                   â”‚
â”‚         // äº‹åŠ¡3: æ’å…¥æ“ä½œå†å²                                   â”‚
â”‚         func(tx) { InsertOperationHistory(ohr) }                 â”‚
â”‚     )                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Serviceå±‚: RunCDCJob()                                          â”‚
â”‚  æ–‡ä»¶: pkg/cdc/service/job_opt_service.go:15                     â”‚
â”‚                                                                   â”‚
â”‚  æ ¹æ®è¿è¡Œç³»ç»Ÿç±»å‹åˆ†å‘ï¼š                                           â”‚
â”‚                                                                   â”‚
â”‚  switch job.RunSystem {                                          â”‚
â”‚      case "k8s":                                                 â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚          â”‚ K8séƒ¨ç½²æ–¹å¼ (ä¸»æµæ–¹å¼)                  â”‚            â”‚
â”‚          â”‚ k8s.CreateCDCDeploy(job)                â”‚            â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                   â”‚
â”‚      case "controller":                                          â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚          â”‚ Controlleræ–¹å¼ï¼ˆHAæ¨¡å¼ï¼‰                â”‚            â”‚
â”‚          â”‚ cdc_controller.StartControllerJob(job)  â”‚            â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚  }                                                               â”‚
â”‚                                                                   â”‚
â”‚  æˆåŠŸåä¸ŠæŠ¥é…é¢ä¿¡æ¯ï¼š                                             â”‚
â”‚  go cdc_quota.CDCQuotaLogReport(job, CreateQuotaFlowApply)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ ä»¥K8séƒ¨ç½²ä¸ºä¾‹ï¼ˆä¸»æµæ–¹å¼ï¼‰â†“
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  K8så±‚: CreateCDCDeploy()                                        â”‚
â”‚  æ–‡ä»¶: pkg/cdc/service/external/k8s/k8s_service.go:96            â”‚
â”‚                                                                   â”‚
â”‚  æ­¥éª¤1: åˆ›å»ºConfigMap                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ createConfigMap(job)                                       â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ 1. è·å–K8så®¢æˆ·ç«¯                                           â”‚ â”‚
â”‚  â”‚    client := connector.GetInstance().GetCDCClientSets(    â”‚ â”‚
â”‚  â”‚        job.Env, job.Region, job.Az                        â”‚ â”‚
â”‚  â”‚    )                                                       â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ 2. å…ˆåˆ é™¤æ—§çš„ConfigMapï¼ˆå¦‚æœå­˜åœ¨ï¼‰                         â”‚ â”‚
â”‚  â”‚    client.CoreV1().ConfigMaps(namespace).Delete(          â”‚ â”‚
â”‚  â”‚        getDeployName(job.JobName),                        â”‚ â”‚
â”‚  â”‚        metav1.DeleteOptions{}                             â”‚ â”‚
â”‚  â”‚    )                                                       â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ 3. åˆ›å»ºæ–°çš„ConfigMap                                       â”‚ â”‚
â”‚  â”‚    configMap := &ConfigMap{                               â”‚ â”‚
â”‚  â”‚        ObjectMeta: metav1.ObjectMeta{                     â”‚ â”‚
â”‚  â”‚            Name: job.JobName,                             â”‚ â”‚
â”‚  â”‚            Namespace: "cdc-live/cdc-test",                â”‚ â”‚
â”‚  â”‚        },                                                  â”‚ â”‚
â”‚  â”‚        Data: map[string]string{                           â”‚ â”‚
â”‚  â”‚            "config.json": job.CDCConfig,  // CDCé…ç½®JSON  â”‚ â”‚
â”‚  â”‚        },                                                  â”‚ â”‚
â”‚  â”‚    }                                                       â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚    client.CoreV1().ConfigMaps(namespace).Create(          â”‚ â”‚
â”‚  â”‚        context.TODO(),                                    â”‚ â”‚
â”‚  â”‚        configMap,                                         â”‚ â”‚
â”‚  â”‚        metav1.CreateOptions{}                             â”‚ â”‚
â”‚  â”‚    )                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  æ­¥éª¤2: åˆ›å»ºDeployment                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ buildDeployment(job)                                       â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ deployment := &Deployment{                                â”‚ â”‚
â”‚  â”‚     ObjectMeta: metav1.ObjectMeta{                        â”‚ â”‚
â”‚  â”‚         Name: job.JobName,                                â”‚ â”‚
â”‚  â”‚     },                                                     â”‚ â”‚
â”‚  â”‚     Spec: DeploymentSpec{                                 â”‚ â”‚
â”‚  â”‚         Selector: &LabelSelector{                         â”‚ â”‚
â”‚  â”‚             MatchLabels: map[string]string{               â”‚ â”‚
â”‚  â”‚                 "job-name": job.JobName,                  â”‚ â”‚
â”‚  â”‚             },                                            â”‚ â”‚
â”‚  â”‚         },                                                 â”‚ â”‚
â”‚  â”‚         Template: PodTemplateSpec{                        â”‚ â”‚
â”‚  â”‚             ObjectMeta: metav1.ObjectMeta{                â”‚ â”‚
â”‚  â”‚                 Labels: map[string]string{                â”‚ â”‚
â”‚  â”‚                     "job-name": job.JobName,              â”‚ â”‚
â”‚  â”‚                 },                                        â”‚ â”‚
â”‚  â”‚             },                                            â”‚ â”‚
â”‚  â”‚             Spec: PodSpec{                                â”‚ â”‚
â”‚  â”‚                 Containers: []Container{                  â”‚ â”‚
â”‚  â”‚                     {                                     â”‚ â”‚
â”‚  â”‚                         Name: job.JobName,                â”‚ â”‚
â”‚  â”‚                         Image: job.ImageVersion,  // CDCé•œåƒâ”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚                         // æŒ‚è½½ConfigMapä½œä¸ºé…ç½®æ–‡ä»¶        â”‚ â”‚
â”‚  â”‚                         VolumeMounts: []VolumeMount{      â”‚ â”‚
â”‚  â”‚                             {                             â”‚ â”‚
â”‚  â”‚                                 Name: job.JobName,        â”‚ â”‚
â”‚  â”‚                                 MountPath: "/workspace/config/",â”‚ â”‚
â”‚  â”‚                                 ReadOnly: true,           â”‚ â”‚
â”‚  â”‚                             },                            â”‚ â”‚
â”‚  â”‚                         },                                â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚                         // èµ„æºé™åˆ¶                        â”‚ â”‚
â”‚  â”‚                         Resources: ResourceRequirements{  â”‚ â”‚
â”‚  â”‚                             Limits: {                     â”‚ â”‚
â”‚  â”‚                                 CPU: "1000m",  // 1æ ¸      â”‚ â”‚
â”‚  â”‚                                 Memory: "2Gi", // 2GB      â”‚ â”‚
â”‚  â”‚                             },                            â”‚ â”‚
â”‚  â”‚                         },                                â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚                         // å¯åŠ¨å‘½ä»¤                        â”‚ â”‚
â”‚  â”‚                         Command: ["streamer"],            â”‚ â”‚
â”‚  â”‚                         Args: [                           â”‚ â”‚
â”‚  â”‚                             "--local",                    â”‚ â”‚
â”‚  â”‚                             "--stdout",                   â”‚ â”‚
â”‚  â”‚                             "--config",                   â”‚ â”‚
â”‚  â”‚                             "/workspace/config/config.json"â”‚ â”‚
â”‚  â”‚                         ],                                â”‚ â”‚
â”‚  â”‚                     }                                     â”‚ â”‚
â”‚  â”‚                 },                                        â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚                 // æŒ‚è½½ConfigMapå·                         â”‚ â”‚
â”‚  â”‚                 Volumes: []Volume{                        â”‚ â”‚
â”‚  â”‚                     {                                     â”‚ â”‚
â”‚  â”‚                         Name: job.JobName,                â”‚ â”‚
â”‚  â”‚                         VolumeSource: VolumeSource{       â”‚ â”‚
â”‚  â”‚                             ConfigMap: &ConfigMapVolumeSource{â”‚ â”‚
â”‚  â”‚                                 LocalObjectReference: {   â”‚ â”‚
â”‚  â”‚                                     Name: job.JobName,    â”‚ â”‚
â”‚  â”‚                                 },                        â”‚ â”‚
â”‚  â”‚                             },                            â”‚ â”‚
â”‚  â”‚                         },                                â”‚ â”‚
â”‚  â”‚                     }                                     â”‚ â”‚
â”‚  â”‚                 },                                        â”‚ â”‚
â”‚  â”‚             },                                            â”‚ â”‚
â”‚  â”‚         },                                                 â”‚ â”‚
â”‚  â”‚     },                                                     â”‚ â”‚
â”‚  â”‚ }                                                          â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ client.AppsV1().Deployments(namespace).Create(            â”‚ â”‚
â”‚  â”‚     context.TODO(),                                       â”‚ â”‚
â”‚  â”‚     deployment,                                           â”‚ â”‚
â”‚  â”‚     metav1.CreateOptions{}                                â”‚ â”‚
â”‚  â”‚ )                                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ âœ… K8s Deploymentåˆ›å»ºæˆåŠŸ
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Kubernetesé›†ç¾¤è°ƒåº¦Pod                                â”‚
â”‚                                                                   â”‚
â”‚  1. K8sè°ƒåº¦å™¨é€‰æ‹©åˆé€‚çš„èŠ‚ç‚¹                                       â”‚
â”‚  2. Kubeletæ‹‰å–CDCé•œåƒï¼ˆstreamerï¼‰                                â”‚
â”‚  3. åˆ›å»ºPodå¹¶æŒ‚è½½ConfigMap                                        â”‚
â”‚  4. å¯åŠ¨å®¹å™¨                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              CDC Workerå®¹å™¨å¯åŠ¨                                   â”‚
â”‚                                                                   â”‚
â”‚  å®¹å™¨å†…æ‰§è¡Œå‘½ä»¤:                                                  â”‚
â”‚  streamer --local --stdout --config /workspace/config/config.jsonâ”‚
â”‚                                                                   â”‚
â”‚  æ­¥éª¤1: è¯»å–é…ç½®æ–‡ä»¶                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ä» /workspace/config/config.json è¯»å–CDCé…ç½®                â”‚ â”‚
â”‚  â”‚ - MySQLè¿æ¥ä¿¡æ¯                                            â”‚ â”‚
â”‚  â”‚ - Kafkaè¿æ¥ä¿¡æ¯                                            â”‚ â”‚
â”‚  â”‚ - å…ƒæ•°æ®å­˜å‚¨ä¿¡æ¯                                           â”‚ â”‚
â”‚  â”‚ - è¿‡æ»¤è§„åˆ™                                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  æ­¥éª¤2: è¿æ¥å…ƒæ•°æ®å­˜å‚¨                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ è¿æ¥åˆ°å…ƒæ•°æ®MySQLæˆ–HTTPæœåŠ¡                                â”‚ â”‚
â”‚  â”‚ - æŸ¥è¯¢ä¸Šæ¬¡åŒæ­¥çš„GTIDä½ç½®                                   â”‚ â”‚
â”‚  â”‚ - å¦‚æœæ˜¯é¦–æ¬¡å¯åŠ¨ï¼Œä»å½“å‰ä½ç½®å¼€å§‹                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  æ­¥éª¤3: è¿æ¥æºMySQLæ•°æ®åº“                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ä½¿ç”¨é…ç½®çš„è´¦å·å¯†ç è¿æ¥MySQL                                â”‚ â”‚
â”‚  â”‚ - User: rds_rep_gds                                        â”‚ â”‚
â”‚  â”‚ - Host: db-master-order-sg.shopee.io:6606                 â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ å‘èµ·binlog dumpè¯·æ±‚ï¼š                                      â”‚ â”‚
â”‚  â”‚ COM_BINLOG_DUMP_GTID                                       â”‚ â”‚
â”‚  â”‚ - GTID: xxxxx:1-12345                                     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  æ­¥éª¤4: æ¥æ”¶å¹¶è§£æbinlogäº‹ä»¶                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ MySQL ServeræŒç»­æ¨é€binlogäº‹ä»¶ï¼š                           â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ - ROTATE_EVENT (åˆ‡æ¢æ—¥å¿—æ–‡ä»¶)                             â”‚ â”‚
â”‚  â”‚ - FORMAT_DESCRIPTION_EVENT                                â”‚ â”‚
â”‚  â”‚ - GTID_EVENT                                              â”‚ â”‚
â”‚  â”‚ - QUERY_EVENT (DDL: CREATE/ALTER/DROP)                   â”‚ â”‚
â”‚  â”‚ - TABLE_MAP_EVENT (è¡¨ç»“æ„æ˜ å°„)                            â”‚ â”‚
â”‚  â”‚ - WRITE_ROWS_EVENT (INSERTæ“ä½œ)                           â”‚ â”‚
â”‚  â”‚ - UPDATE_ROWS_EVENT (UPDATEæ“ä½œ)                          â”‚ â”‚
â”‚  â”‚ - DELETE_ROWS_EVENT (DELETEæ“ä½œ)                          â”‚ â”‚
â”‚  â”‚ - XID_EVENT (äº‹åŠ¡æäº¤)                                    â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ CDC Workerè§£æè¿™äº›äº‹ä»¶ï¼š                                   â”‚ â”‚
â”‚  â”‚ 1. è§£æè¡¨ç»“æ„ï¼ˆTABLE_MAP_EVENTï¼‰                          â”‚ â”‚
â”‚  â”‚ 2. è§£æDMLæ“ä½œï¼ˆWRITE/UPDATE/DELETE_ROWS_EVENTï¼‰          â”‚ â”‚
â”‚  â”‚ 3. æå–å˜æ›´æ•°æ®ï¼š                                          â”‚ â”‚
â”‚  â”‚    {                                                       â”‚ â”‚
â”‚  â”‚        "database": "shopee_order_db_00000000",            â”‚ â”‚
â”‚  â”‚        "table": "order_info",                             â”‚ â”‚
â”‚  â”‚        "type": "insert",                                  â”‚ â”‚
â”‚  â”‚        "data": {                                          â”‚ â”‚
â”‚  â”‚            "order_id": 123456,                            â”‚ â”‚
â”‚  â”‚            "user_id": 789,                                â”‚ â”‚
â”‚  â”‚            "amount": 99.99,                               â”‚ â”‚
â”‚  â”‚            "create_time": "2023-10-22 10:00:00"           â”‚ â”‚
â”‚  â”‚        }                                                   â”‚ â”‚
â”‚  â”‚    }                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  æ­¥éª¤5: è¿‡æ»¤å’Œè½¬æ¢                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ 1. åº”ç”¨FilterRuleè¿‡æ»¤ï¼š                                    â”‚ â”‚
â”‚  â”‚    "^(shopee_order_db_00000000)\..*$"                     â”‚ â”‚
â”‚  â”‚    åªå¤„ç†åŒ¹é…çš„æ•°æ®åº“.è¡¨                                   â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ 2. åº”ç”¨DMLè¿‡æ»¤è§„åˆ™ï¼ˆå¦‚æœé…ç½®ï¼‰ï¼š                            â”‚ â”‚
â”‚  â”‚    è·³è¿‡ç‰¹å®šç±»å‹çš„DMLï¼ˆå¦‚åªè¦INSERTå’ŒUPDATEï¼‰              â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ 3. è®¡ç®—åˆ†åŒºé”®ï¼š                                            â”‚ â”‚
â”‚  â”‚    PartitionKey = "db_name.table_name"                    â”‚ â”‚
â”‚  â”‚    â†’ "shopee_order_db_00000000.order_info"                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  æ­¥éª¤6: å‘é€åˆ°Kafka                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ è¿æ¥Kafkaé›†ç¾¤ï¼š                                            â”‚ â”‚
â”‚  â”‚ - Server: kafka.sg.shopee.io:9092                         â”‚ â”‚
â”‚  â”‚ - Topic: cdc_topic_shopee_order                           â”‚ â”‚
â”‚  â”‚ - User/Password: kafkaè®¤è¯                                â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ å‘é€æ¶ˆæ¯ï¼š                                                 â”‚ â”‚
â”‚  â”‚ producer.Send({                                            â”‚ â”‚
â”‚  â”‚     Topic: "cdc_topic_shopee_order",                      â”‚ â”‚
â”‚  â”‚     Partition: hash(partition_key) % partition_count,     â”‚ â”‚
â”‚  â”‚     Key: "shopee_order_db_00000000.order_info",           â”‚ â”‚
â”‚  â”‚     Value: json.Marshal(binlogEvent),                     â”‚ â”‚
â”‚  â”‚     Headers: {                                            â”‚ â”‚
â”‚  â”‚         "database": "shopee_order_db_00000000",           â”‚ â”‚
â”‚  â”‚         "table": "order_info",                            â”‚ â”‚
â”‚  â”‚         "operation": "insert",                            â”‚ â”‚
â”‚  â”‚         "gtid": "xxxxx:1-12345",                          â”‚ â”‚
â”‚  â”‚     }                                                      â”‚ â”‚
â”‚  â”‚ })                                                         â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ æ‰¹é‡å‘é€é…ç½®ï¼š                                              â”‚ â”‚
â”‚  â”‚ - FlushBatch: 50æ¡æ¶ˆæ¯æ‰¹é‡å‘é€                             â”‚ â”‚
â”‚  â”‚ - ACKs: WaitForAll (ç­‰å¾…æ‰€æœ‰å‰¯æœ¬ç¡®è®¤)                      â”‚ â”‚
â”‚  â”‚ - MaxMessageBytes: 1048588 (çº¦1MB)                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  æ­¥éª¤7: æ›´æ–°åŒæ­¥ä½ç‚¹                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ å®šæœŸå°†å½“å‰GTIDä½ç‚¹ä¿å­˜åˆ°å…ƒæ•°æ®å­˜å‚¨ï¼š                        â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ UPDATE metadata SET                                        â”‚ â”‚
â”‚  â”‚     gtid_set = 'xxxxx:1-12345',                           â”‚ â”‚
â”‚  â”‚     binlog_file = 'mysql-bin.000123',                     â”‚ â”‚
â”‚  â”‚     binlog_pos = 987654,                                  â”‚ â”‚
â”‚  â”‚     update_time = NOW()                                   â”‚ â”‚
â”‚  â”‚ WHERE job_name = 'shopee_order-abc123'                    â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚ ç”¨é€”ï¼šä»»åŠ¡é‡å¯åå¯ä»¥ä»ä¸Šæ¬¡ä½ç½®ç»§ç»­                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  æ­¥éª¤8: ç›‘æ§ä¸ä¸ŠæŠ¥                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ä¸ŠæŠ¥PrometheusæŒ‡æ ‡ï¼š                                       â”‚ â”‚
â”‚  â”‚ - cdc_binlog_events_total (å¤„ç†çš„äº‹ä»¶æ€»æ•°)                 â”‚ â”‚
â”‚  â”‚ - cdc_binlog_lag_seconds (åŒæ­¥å»¶è¿Ÿ)                        â”‚ â”‚
â”‚  â”‚ - cdc_kafka_send_success (Kafkaå‘é€æˆåŠŸæ•°)                 â”‚ â”‚
â”‚  â”‚ - cdc_kafka_send_failed (Kafkaå‘é€å¤±è´¥æ•°)                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ ğŸ”„ æŒç»­è¿è¡Œï¼Œå®æ—¶åŒæ­¥binlog
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ä¸‹æ¸¸Kafkaæ¶ˆè´¹è€…å¤„ç†                                  â”‚
â”‚                                                                   â”‚
â”‚  æ¶ˆè´¹è€…è®¢é˜…Topic: cdc_topic_shopee_order                          â”‚
â”‚                                                                   â”‚
â”‚  æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ ¼å¼ï¼š                                               â”‚
â”‚  {                                                                â”‚
â”‚      "database": "shopee_order_db_00000000",                     â”‚
â”‚      "table": "order_info",                                      â”‚
â”‚      "type": "insert",                                           â”‚
â”‚      "timestamp": 1698036000,                                    â”‚
â”‚      "gtid": "xxxxx:1-12345",                                    â”‚
â”‚      "data": {                                                   â”‚
â”‚          "order_id": 123456,                                     â”‚
â”‚          "user_id": 789,                                         â”‚
â”‚          "amount": 99.99,                                        â”‚
â”‚          "status": "created",                                    â”‚
â”‚          "create_time": "2023-10-22 10:00:00"                    â”‚
â”‚      },                                                          â”‚
â”‚      "old_data": null  // UPDATEæ—¶æ‰æœ‰                           â”‚
â”‚  }                                                               â”‚
â”‚                                                                   â”‚
â”‚  åº”ç”¨åœºæ™¯ï¼š                                                       â”‚
â”‚  - æ•°æ®åŒæ­¥åˆ°æ•°æ®ä»“åº“                                             â”‚
â”‚  - å®æ—¶æ•°æ®åˆ†æ                                                   â”‚
â”‚  - ç¼“å­˜åˆ·æ–°                                                       â”‚
â”‚  - æœç´¢å¼•æ“ç´¢å¼•æ›´æ–°                                               â”‚
â”‚  - è§¦å‘ä¸‹æ¸¸ä¸šåŠ¡é€»è¾‘                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ å…³é”®æ•°æ®ç»“æ„

### 1. CDCJob (ä»»åŠ¡ä¸»è¡¨)

```go
type CDCJob struct {
    ID            uint64           // ä»»åŠ¡ID
    Env           string           // ç¯å¢ƒ: live/test
    JobName       string           // ä»»åŠ¡åç§°: cluster-uuid
    CDCConfig     string           // CDCé…ç½®JSON
    ImageVersion  string           // Dockeré•œåƒç‰ˆæœ¬
    Region        string           // åŒºåŸŸ: sg/us/br
    Az            string           // å¯ç”¨åŒº: sg10/us3
    CPU           int              // CPU (m): 1000=1æ ¸
    Memory        int              // å†…å­˜ (GB): 2
    BusinessLevel BusinessLevel    // ä¸šåŠ¡çº§åˆ«: P0/P1/P2
    JobStatus     CDCJobStatus     // çŠ¶æ€: stopped/running/warning
    RunSystem     CDCRunSystem     // è¿è¡Œç³»ç»Ÿ: k8s/controller
    CreateTime    int64            // åˆ›å»ºæ—¶é—´
    UpdateTime    int64            // æ›´æ–°æ—¶é—´
}
```

### 2. CDCJobDetail (ä»»åŠ¡è¯¦æƒ…è¡¨)

```go
type CDCJobDetail struct {
    ID                    uint64   // è¯¦æƒ…ID
    Env                   string   // ç¯å¢ƒ
    JobName               string   // ä»»åŠ¡åç§°
    MysqlHost             string   // MySQLä¸»æœº
    MysqlDatabase         string   // æ•°æ®åº“å
    Topic                 string   // Kafka Topic
    KafkaCluster          string   // Kafkaé›†ç¾¤å
    KafkaAddress          string   // Kafkaåœ°å€
    KafkaProducerUser     string   // Kafkaç”¨æˆ·
    KafkaProducerPassword string   // Kafkaå¯†ç 
    KafkaMaxMessageBytes  int64    // æœ€å¤§æ¶ˆæ¯å¤§å°
    DMLFilteredType       string   // DMLè¿‡æ»¤ç±»å‹
    KafkaAck              string   // ACKæ¨¡å¼: WaitForAll/WaitForLocal
    CreateTime            int64    // åˆ›å»ºæ—¶é—´
    UpdateTime            int64    // æ›´æ–°æ—¶é—´
}
```

### 3. CDCConfig (CDCé…ç½®JSON)

```go
type CDCConfig struct {
    Env            string       // ç¯å¢ƒ
    Name           string       // ä»»åŠ¡åç§°
    SourceInstance string       // æºMySQLåœ°å€
    SourceType     string       // æºç±»å‹: mysql.no_schema
    SourceUser     string       // MySQLç”¨æˆ·
    SourcePassword string       // MySQLå¯†ç 
    TargetType     string       // ç›®æ ‡ç±»å‹: cdc
    SinkType       string       // Sinkç±»å‹: cdc
    TaskName       string       // ä»»åŠ¡å
    
    ExtraConfig    ExtraConfig  // é¢å¤–é…ç½®
    CDCStreams     CDCStreams   // CDCæµé…ç½®
    ConfigDetail   ConfigDetail // é…ç½®è¯¦æƒ…
}

type ExtraConfig struct {
    MetadataType      string   // å…ƒæ•°æ®ç±»å‹: mysql/http
    MetadataAddr      string   // å…ƒæ•°æ®åœ°å€
    MetadataNamespace string   // å…ƒæ•°æ®å‘½åç©ºé—´
    MetadataUser      string   // å…ƒæ•°æ®ç”¨æˆ·
    MetadataPasswd    string   // å…ƒæ•°æ®å¯†ç 
    Region            string   // åŒºåŸŸ
    Step              string   // æ­¥éª¤: db_stream_sync,
}

type CDCStreams struct {
    AllConfig      AllConfig        // å…¨å±€é…ç½®
    MQStreams      []MQStream       // MQæµé…ç½®ï¼ˆæ”¯æŒå¤šä¸ªKafkaï¼‰
    DMLFilterRules []DMLFilterRule  // DMLè¿‡æ»¤è§„åˆ™
}

type MQStream struct {
    Type            string  // ç±»å‹: kafka
    FilterRule      string  // è¿‡æ»¤è§„åˆ™ï¼ˆæ­£åˆ™ï¼‰
    Server          string  // Kafkaåœ°å€
    Topic           string  // Topicåç§°
    User            string  // Kafkaç”¨æˆ·
    Passwd          string  // Kafkaå¯†ç 
    PartitionKey    string  // åˆ†åŒºé”®: db_name.table_name
    ACKs            string  // ACKæ¨¡å¼
    FlushBatch      int     // æ‰¹é‡å¤§å°
    MaxMessageBytes int64   // æœ€å¤§æ¶ˆæ¯å­—èŠ‚æ•°
}
```

---

## ğŸ” å…³é”®ä»£ç æ–‡ä»¶ç´¢å¼•

| å±‚æ¬¡ | æ–‡ä»¶è·¯å¾„ | ä¸»è¦åŠŸèƒ½ |
|-----|---------|---------|
| **Handlerå±‚** | pkg/cdc/handler/tools_handler.go:182 | AddCDCJob() - æ¥æ”¶åˆ›å»ºè¯·æ±‚ |
| **Handlerå±‚** | pkg/cdc/handler/job_handler.go:159 | CDCJobStart() - æ¥æ”¶å¯åŠ¨è¯·æ±‚ |
| **Serviceå±‚** | pkg/cdc/service/job_service.go:119 | StartCDCJob() - å¯åŠ¨ä»»åŠ¡ |
| **Serviceå±‚** | pkg/cdc/service/job_opt_service.go:15 | RunCDCJob() - è¿è¡Œä»»åŠ¡ |
| **Serviceå±‚** | pkg/cdc/service/ticket_handler_service.go:716 | BuildConfigForCDC() - æ„å»ºé…ç½® |
| **K8så±‚** | pkg/cdc/service/external/k8s/k8s_service.go:96 | CreateCDCDeploy() - åˆ›å»ºDeployment |
| **K8så±‚** | pkg/cdc/service/external/k8s/k8s_service.go:112 | createConfigMap() - åˆ›å»ºConfigMap |
| **K8så±‚** | pkg/cdc/service/external/k8s/k8s_service.go:134 | buildDeployment() - æ„å»ºDeploymentå¯¹è±¡ |
| **DBå±‚** | pkg/cdc/db/job_db.go | InsertCDCJobWithTx() - æ’å…¥ä»»åŠ¡ |
| **Modelå±‚** | pkg/cdc/model/db_model/job_model.go | CDCJobç»“æ„å®šä¹‰ |
| **Modelå±‚** | pkg/cdc/model/service_model/cdc_config.go | CDCConfigç»“æ„å®šä¹‰ |

---

## âš™ï¸ é…ç½®ç¤ºä¾‹

### å®Œæ•´çš„CDCé…ç½®JSONç¤ºä¾‹

```json
{
  "env": "live",
  "name": "shopee_order_logistics_v2_br-c31b11eb",
  "biz_type": "",
  "priority_level": 1,
  
  "extra_config": {
    "job_tag": {
      "biz_type": "",
      "job_type": "cdc",
      "priority": "1",
      "task_type": "db-message"
    },
    "metadata_addr": "db-master-cdc-meta-sg1-live.shopeemobile.com:6606",
    "metadata_namespace": "shopee_cdc_meta_db",
    "metadata_passwd": "****",
    "metadata_type": "mysql",
    "metadata_user": "cdc_meta",
    "region": "sg",
    "step": "db_stream_sync,"
  },
  
  "source_instance": "db-master-order-sg-00000000-sg1-live.shopeemobile.com:6606",
  "source_password": "****",
  "source_type": "mysql.no_schema",
  "source_user": "rds_rep_gds",
  
  "target_type": "cdc",
  "sink_type": "cdc",
  "task_name": "shopee_order_logistics_v2_br-c31b11eb",
  
  "cdc_streams": {
    "all_config": {
      "key": "val",
      "send_model": "",
      "merge_purge_binlog": false,
      "need_filtered_dml_type": ""
    },
    "dml_filter_rules": [],
    "mq_streams": [
      {
        "type": "kafka",
        "filter_rule": "^(shopee_order_logistics_v2_co_db_00000000)\\..*$",
        "server": "kafka.mbp.ap-sg-1-general-a.live.mq.shopee.io:9092",
        "topic": "cdc_live_shopee_order_logistics_v2_co_db_00000000",
        "user": "cdc-write-user",
        "passwd": "****",
        "partition_key": "db_name.table_name",
        "acks": "WaitForAll",
        "flush_batch": 50,
        "max_message_bytes": 1048588
      }
    ]
  },
  
  "config_detail": {
    "runtime": {
      "sync_rate_limit_qps": 0,
      "read_concurrency": 0,
      "write_concurrency": 0,
      "inc_rate_limit": false
    },
    "stream_sync": true,
    "resource": {
      "cpu": 0,
      "memory": ""
    }
  },
  
  "switch_az_info": {
    "version": 0
  }
}
```

---

## ğŸ¯ æ ¸å¿ƒæµç¨‹æ€»ç»“

1. **åˆ›å»ºé˜¶æ®µ** (åœæ­¢çŠ¶æ€)
   - ç”¨æˆ·æäº¤ â†’ Handlerè§£æ â†’ Serviceæ„å»ºé…ç½® â†’ ä¿å­˜åˆ°æ•°æ®åº“
   - çŠ¶æ€: `stopped`

2. **å¯åŠ¨é˜¶æ®µ** (å¯åŠ¨ä»»åŠ¡)
   - ç”¨æˆ·è§¦å‘å¯åŠ¨ â†’ ServiceéªŒè¯ â†’ åˆ›å»ºK8sèµ„æº â†’ æ›´æ–°çŠ¶æ€ä¸ºrunning

3. **K8séƒ¨ç½²é˜¶æ®µ**
   - åˆ›å»ºConfigMap (CDCé…ç½®æ–‡ä»¶)
   - åˆ›å»ºDeployment (CDC Workerå®¹å™¨)

4. **CDC Workerè¿è¡Œé˜¶æ®µ**
   - è¯»å–é…ç½® â†’ è¿æ¥MySQL â†’ æ¥æ”¶binlog â†’ è§£æäº‹ä»¶ â†’ å‘é€Kafka â†’ æ›´æ–°ä½ç‚¹

5. **æŒç»­åŒæ­¥é˜¶æ®µ**
   - å®æ—¶æ¥æ”¶binlogäº‹ä»¶
   - è¿‡æ»¤å’Œè½¬æ¢æ•°æ®
   - æ‰¹é‡å‘é€åˆ°Kafka
   - å®šæœŸä¿å­˜åŒæ­¥ä½ç‚¹

---

## ğŸš¨ å…³é”®æ³¨æ„äº‹é¡¹

1. **äº‹åŠ¡ä¿è¯**: åˆ›å»ºå’Œå¯åŠ¨ä»»åŠ¡éƒ½ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ä¿è¯ä¸€è‡´æ€§

2. **å¹‚ç­‰æ€§**: K8sèµ„æºåˆ›å»ºå‰å…ˆåˆ é™¤æ—§èµ„æºï¼Œé¿å…é‡å¤åˆ›å»º

3. **é…ç½®ç®¡ç†**: CDCé…ç½®ä»¥ConfigMapæ–¹å¼æŒ‚è½½ï¼Œæ”¯æŒåŠ¨æ€æ›´æ–°

4. **ä½ç‚¹ç®¡ç†**: é€šè¿‡å…ƒæ•°æ®å­˜å‚¨ä¿å­˜GTIDä½ç‚¹ï¼Œæ”¯æŒä»»åŠ¡é‡å¯æ¢å¤

5. **ç›‘æ§å‘Šè­¦**: é›†æˆPrometheuså’ŒSeatalkï¼Œå®æ—¶ç›‘æ§ä»»åŠ¡çŠ¶æ€

6. **é…é¢æ§åˆ¶**: ä»»åŠ¡å¯åŠ¨åä¸ŠæŠ¥é…é¢ä¿¡æ¯ï¼Œè¿›è¡Œèµ„æºç®¡ç†

7. **å¤šç¯å¢ƒæ”¯æŒ**: æ”¯æŒtest/live/liveishç­‰å¤šç¯å¢ƒéƒ¨ç½²

8. **é«˜å¯ç”¨**: æ”¯æŒK8så’ŒControllerä¸¤ç§è¿è¡Œæ¨¡å¼

---

## ğŸ“Š çŠ¶æ€æµè½¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   åˆ›å»º    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   å¯åŠ¨    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ—      â”‚ â”€â”€â”€â”€â”€â”€â”€â”€> â”‚ stopped  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€> â”‚ running  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â–²                      â”‚
                             â”‚       åœæ­¢           â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â”‚ å¼‚å¸¸
                                      â–¼
                                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                â”‚ warning  â”‚
                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ æ€»ç»“

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä¼ä¸šçº§CDCç®¡ç†ç³»ç»Ÿï¼Œä»HTTP APIåˆ°K8så®¹å™¨éƒ¨ç½²ï¼Œå†åˆ°binlogå®æ—¶åŒæ­¥åˆ°Kafkaçš„å…¨æµç¨‹å®ç°ã€‚æ ¸å¿ƒç‰¹ç‚¹ï¼š

âœ… **åˆ†å±‚æ¶æ„**: Handler â†’ Service â†’ K8s â†’ CDC Worker  
âœ… **å£°æ˜å¼é…ç½®**: é€šè¿‡JSONé…ç½®é©±åŠ¨CDCè¡Œä¸º  
âœ… **å®¹å™¨åŒ–éƒ¨ç½²**: K8sç®¡ç†CDC Workerç”Ÿå‘½å‘¨æœŸ  
âœ… **é«˜å¯é æ€§**: äº‹åŠ¡ä¿è¯ã€ä½ç‚¹ç®¡ç†ã€è‡ªåŠ¨æ¢å¤  
âœ… **å¯æ‰©å±•æ€§**: æ”¯æŒå¤šæ•°æ®åº“ã€å¤šKafkaã€å¤šç¯å¢ƒ  
âœ… **å¯è§‚æµ‹æ€§**: Prometheusç›‘æ§ + Seatalkå‘Šè­¦  

æ•´ä¸ªæµç¨‹å®ç°äº†MySQL binlogåˆ°Kafkaçš„å®æ—¶æ•°æ®åŒæ­¥èƒ½åŠ›ï¼Œä¸ºä¸‹æ¸¸æ•°æ®åˆ†æã€ç¼“å­˜åˆ·æ–°ã€æœç´¢ç´¢å¼•ç­‰åœºæ™¯æä¾›åŸºç¡€æ”¯æ’‘ã€‚

